<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ejercicio 13: Prueba smoke - Fatima González Romo</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="exercises.css">
    <script src="script.js"></script>
</head>
<body>
    <div class="container ejercicio12">
        <div class="header">
            <a href="index.html" class="back-btn">← Volver al Menú</a>
            <h1>Ejercicio 13: Prueba smoke</h1>
            <p>1–5 usuarios, verificación rápida de disponibilidad.</p>
        </div>
        
        <div class="content">
            <!-- Información del Ejercicio -->
            <div class="exercise-info">
                <h3>Introducción</h3>
                <p>En este ejercicio se evaluará el desempeño de los microservicios que conforman la aplicación PredictHealth, una plataforma orientada al análisis y predicción de riesgos en salud. El sistema está compuesto por diversos microoservicios que operan de forma coordinada, entre ellos:</p>
                <ul>
                    <li>auth: encargado de la autenticación y emisión de tokens.</li>
                    <li>register: gestión del registro de nuevos usuarios.</li>
                    <li>patient: administración de perfiles y expedientes de pacientes.</li>
                    <li>health: operaciones generales de información médica.</li>
                    <li>diabetes: motor de predicción y análisis de riesgo para diabetes.</li>
                    <li>hypertension: procesamiento de predicciones y evaluaciones de hipertensión.</li>
                    <li>data: manejo de datos clínicos.</li>
                    <li>recommendations: generación de recomendaciones personalizadas para el usuario.</li>
                </ul>
                <p>Dado que PredictHealth depende de la interacción simultánea entre múltiples microservicios, resulta fundamental validar que cada uno mantenga un comportamiento estable, eficiente y escalable bajo distintos niveles de carga. Las pruebas de rendimiento permiten identificar cuellos de botella, medir tiempos de respuesta, determinar la tolerancia al tráfico inesperado y garantizar que el sistema pueda sostener un uso real en producción.</p>
                <p>Estas pruebas son especialmente importantes en aplicaciones del sector salud, donde los fallos pueden impactar directamente en la disponibilidad y confiabilidad de la información médica. Por ello, la ejecución sistemática de pruebas baseline, smoke, ramp-up, spike, soak y break-point constituye un paso crítico para asegurar que los microservicios de PredictHealth operen correctamente ante escenarios exigentes y condiciones cambiantes de carga.</p>
            </div>

            <div class="exercise-info">
                <h3>Objetivos Específicos</h3>
                <p>A continuación, se presentan los objetivos específicos de cada tipo de prueba de rendimiento que se aplicará a los microservicios del sistema:</p>

                <p>2. <strong>Prueba Smoke (1–5 usuarios)</strong></p>
                <ul>
                    <li>Verificar rápidamente que los servicios están activos y responden adecuadamente.</li>
                    <li>Confirmar que las rutas esenciales funcionan sin fallos.</li>
                    <li>Detectar errores críticos de configuración, despliegue o comunicación entre microservicios.</li>
                </ul>
            </div>

            <div class="exercise-info">
                <h3>Metodología</h3>
                <ol>
                    <li><strong>Arquitectura del entorno de prueba</strong>: se configuró una arquitectura basada en microservicios independientes, cada uno ejecutándose en un puerto diferente en localhost. El generador de carga (Locust) interactuó directamente con los servicios mediante solicitudes HTTP.
                        <div class="architecture-diagram">
                            <div class="screenshot-item">
                                    <img src="images/Pruebas/Arquitectura.png" alt="Arquitectura de microservicios para pruebas con Locust" onclick="openImageModal(this.src)">
                            </div>
                        </div>
                    </li>
                    <li><strong>Herramientas utilizadas</strong>:
                        <ul>
                            <li>Locust: herramienta principal para la generación de carga y ejecución de pruebas de rendimiento.</li>
                            <li>Lenguaje de scripting: Python.</li>
                            <li>Sistema operativo: macOS, Linux o Windows.</li>
                            <li>Formato de resultados: archivos CSV generados y reportes HTML para visualización ejecutiva.</li>
                        </ul>
                    </li>
                    <li><strong>Descripción de los escenarios de carga</strong>:
                        <ul>
                            <li><strong>Prueba Smoke</strong>
                                <ul>
                                    <li>Usuarios: 10</li>
                                    <li>Duración: 2 minutos</li>
                                    <li>Tasa de spawn: 2 usuarios/segundo</li>
                                    <li>Descripción: Esta prueba se usó como verificación preliminar del sistema para asegurar que todos los servicios respondieran correctamente antes de ejecutar escenarios más complejos.</li>
                                </ul>
                            </li>
                        </ol>
                    </li>
                </ol>
            </div>

            <!-- Código -->
            <div class="code-section">
                <h3>Código generado</h3>
                <h4>Archivo locustfile.py</h4>
                <div class="code-preview">
                    <div class="code-header-bar">
                        <div class="code-language">Python</div>
                    </div>
                    <pre class="code-display"><code>"""
PredictHealth Microservices Load Testing Suite

Usage:
    # Run with Web UI
    locust -f locustfile.py

    # Run specific test class
    locust -f locustfile.py BaselineTest

    # Headless mode (smoke test example)
    locust -f locustfile.py SmokeTest --headless --users 10 --spawn-rate 2 --run-time 2m

    # CSV test with data
    locust -f locustfile.py CSVTest --headless --users 50 --spawn-rate 10 --run-time 5m

Note: Services use absolute URLs with specific ports (8001-8011), so --host flag is not needed.

Test Scenarios:
    - BaselineTest: Normal load (50 users, steady)
    - SmokeTest: Minimal load verification (10 users, 2 min)
    - ReadHeavyTest: 80% reads, 20% writes
    - WriteHeavyTest: 80% writes, 20% reads
    - RampUpTest: Gradual increase 10→100 users
    - RampDownTest: Gradual decrease 100→10 users
    - SpikeTest: Sudden burst to 200 users
    - SoakTest: Extended duration (1+ hours) at medium load
    - BreakpointTest: Find system limits (progressive load increase)
    - CSVTest: Data-driven testing with CSV users
"""

import csv
import json
import random
import time
from typing import Optional
from locust import HttpUser, TaskSet, task, between, constant, constant_pacing  # LoadTestShape disabled for now
# from locust import LoadTestShape  # Uncomment to enable custom load shapes
from locust.exception import StopUser


# =============================================================================
# Configuration & Test Data
# =============================================================================

# Service ports
SERVICES = {
    "auth": 8001,
    "register": 8002,
    "patient": 8003,
    "health": 8004,
    "diabetes": 8008,
    "hypertension": 8009,
    "data": 8010,
    "recommendations": 8011,
}

# Test users (from init.sql - 200 users with complete patient data in database)
# All users use password: password123
# 100 users from cdc-diabetes dataset + 100 users from hypertension dataset
TEST_USERS = [
    # Generate all 200 users programmatically to avoid huge list
    # Pattern: user_1@cdc-diabetes.com through user_100@cdc-diabetes.com
    #         user_1@hypertension-risk.com through user_100@hypertension-risk.com
    *[{"email": f"user_{i}@cdc-diabetes.com", "password": "password123"} for i in range(1, 101)],
    *[{"email": f"user_{i}@hypertension-risk.com", "password": "password123"} for i in range(1, 101)],
]

# Sample patient data
SAMPLE_PATIENT = {
    "nombre": "Juan",
    "apellido": "Pérez",
    "fecha_nacimiento": "1985-05-15",
    "sexo": "M",
}

# Sample lifestyle data
SAMPLE_LIFESTYLE = {
    "frutas": "true",
    "verduras": "true",
    "fuma": "false",
    "alcohol": "false",
    "movilidad": "false",
    "sal": "5.0",
    "horas_sueno": "7",
    "nivel_estres": "5",
    "salud_mental": "2",
    "actividad_fisica": "3",
    "actividad_frecuente": "true",
    "salud_fisica": "1",
}

# Sample hypertension prediction data
SAMPLE_HYPERTENSION = {
    "age": 45,
    "salt_intake": 7.5,
    "stress_score": 6,
    "sleep_duration": 6.5,
    "bmi": 28.5,
    "medication": 0,
    "family_history": 1,
    "exercise_level": 2,
}

# Sample full history data for /guardar_historial endpoint
SAMPLE_FULL_HISTORY = {
    "nombre": "LoadTest",
    "apellido": "User",
    "fecha_nacimiento": "1990-01-01",
    "sexo": "M",
    "diabetes": False,
    "hipertension": False,
    "colesterol": "Normal",
    "colesterol_alto": "No",
    "bmi": 25.5,
    "presion": "Normal",
    "salud_general": "Buena",
    "acv": "No",
    "problemas_corazon": "No",
    "medicamentos": ["Ninguno"],
    "estilo_vida": {
        "frutas": "true",
        "verduras": "true",
        "fuma": "false",
        "alcohol": "false",
        "movilidad": "false",
        "sal": "5.0",
        "horas_sueno": "7",
        "nivel_estres": "5",
        "salud_mental": "2",
        "actividad_fisica": "3",
        "actividad_frecuente": "true",
        "salud_fisica": "1",
    }
}


# =============================================================================
# Helper Functions
# =============================================================================

def get_service_url(service_name: str) -> str:
    """Build service URL from base host and port"""
    port = SERVICES.get(service_name, 8000)
    return f"http://localhost:{port}"


# =============================================================================
# Base User Behavior
# =============================================================================

class PredictHealthUser(HttpUser):
    """Base user class with authentication and common tasks"""
    
    abstract = True  # Don't run this directly
    host = "http://localhost"  # Base host (services use absolute URLs with specific ports)
    access_token: Optional[str] = None
    user_id: Optional[int] = None
    user_email: Optional[str] = None
    
    def on_start(self):
        """Called when a simulated user starts - perform login"""
        self.login()
    
    def login(self):
        """Authenticate and get access token"""
        # Pick random test user
        user_creds = random.choice(TEST_USERS)
        
        response = self.client.post(
            f"{get_service_url('auth')}/auth/login",
            json={
                "username": user_creds["email"],
                "password": user_creds["password"]
            },
            name="/auth/login"
        )
        
        if response.status_code == 200:
            data = response.json()
            self.access_token = data.get("access_token")
            self.user_email = user_creds["email"]
            
            # Get user ID from /auth/me
            if self.access_token:
                me_response = self.client.get(
                    f"{get_service_url('auth')}/auth/me",
                    headers={"Authorization": f"Bearer {self.access_token}"},
                    name="/auth/me"
                )
                if me_response.status_code == 200:
                    me_data = me_response.json()
                    self.user_id = int(me_data.get("sub", 1))
        else:
            # If login fails, use fallback
            self.user_id = 1
            self.access_token = None
    
    def get_auth_headers(self):
        """Return Authorization header dict"""
        if self.access_token:
            return {"Authorization": f"Bearer {self.access_token}"}
        return {}


# =============================================================================
# Task Sets
# =============================================================================

class ReadTasks(TaskSet):
    """Read-heavy operations (GET endpoints)"""
    
    @task(5)
    def get_patient(self):
        """Get patient data"""
        if self.user.user_id:
            self.client.get(
                f"{get_service_url('patient')}/paciente/{self.user.user_id}",
                name="/paciente/{id} [GET]"
            )
    
    @task(5)
    def get_diabetes_prediction(self):
        """Get diabetes prediction"""
        if self.user.user_id and self.user.access_token:
            self.client.get(
                f"{get_service_url('diabetes')}/predict_diabetes/{self.user.user_id}",
                headers=self.user.get_auth_headers(),
                name="/predict_diabetes/{id} [GET]"
            )
    
    @task(3)
    def get_latest_diabetes(self):
        """Get latest diabetes prediction"""
        if self.user.user_id and self.user.access_token:
            self.client.get(
                f"{get_service_url('diabetes')}/prediccion/latest/diabetes/{self.user.user_id}",
                headers=self.user.get_auth_headers(),
                name="/prediccion/latest/diabetes/{id} [GET]"
            )
    
    @task(3)
    def get_latest_hypertension(self):
        """Get latest hypertension prediction"""
        if self.user.user_id and self.user.access_token:
            self.client.get(
                f"{get_service_url('hypertension')}/prediccion/latest/hypertension/{self.user.user_id}",
                headers=self.user.get_auth_headers(),
                name="/prediccion/latest/hypertension/{id} [GET]"
            )
    
    @task(4)
    def get_recommendations(self):
        """Get personalized recommendations"""
        if self.user.user_id and self.user.access_token:
            self.client.get(
                f"{get_service_url('recommendations')}/recommendations/{self.user.user_id}",
                headers=self.user.get_auth_headers(),
                name="/recommendations/{id} [GET]"
            )
    
    @task(2)
    def health_checks(self):
        """Check service health"""
        service = random.choice(["auth", "register"])
        self.client.get(
            f"{get_service_url(service)}/{service}/health",
            name=f"/{service}/health [GET]"
        )


class WriteTasks(TaskSet):
    """Write-heavy operations (POST endpoints)"""
    
    @task(4)
    def create_patient(self):
        """Create/update patient data"""
        if self.user.user_id and self.user.access_token:
            patient_data = SAMPLE_PATIENT.copy()
            patient_data["id_usuario"] = self.user.user_id
            
            self.client.post(
                f"{get_service_url('patient')}/paciente",
                json=patient_data,
                headers=self.user.get_auth_headers(),
                name="/paciente [POST]"
            )
    
    @task(4)
    def create_lifestyle(self):
        """Create lifestyle data"""
        if self.user.user_id and self.user.access_token:
            lifestyle_data = SAMPLE_LIFESTYLE.copy()
            lifestyle_data["id_usuario"] = self.user.user_id
            
            self.client.post(
                f"{get_service_url('health')}/estilo_vida",
                json=lifestyle_data,
                headers=self.user.get_auth_headers(),
                name="/estilo_vida [POST]"
            )
    
    @task(3)
    def predict_hypertension(self):
        """Request hypertension prediction"""
        if self.user.user_id and self.user.access_token:
            hyp_data = SAMPLE_HYPERTENSION.copy()
            hyp_data["id_usuario"] = self.user.user_id
            
            self.client.post(
                f"{get_service_url('hypertension')}/predict_hypertension",
                json=hyp_data,
                headers=self.user.get_auth_headers(),
                name="/predict_hypertension [POST]"
            )
    
    @task(5)
    def save_full_history(self):
        """Save complete patient history"""
        if self.user.user_id and self.user.access_token:
            history_data = SAMPLE_FULL_HISTORY.copy()
            history_data["id_usuario"] = self.user.user_id
            
            self.client.post(
                f"{get_service_url('data')}/guardar_historial",
                json=history_data,
                headers=self.user.get_auth_headers(),
                name="/guardar_historial [POST]"
            )


class MixedTasks(TaskSet):
    """Balanced mix of read and write operations"""
    
    @task(10)
    def read_operations(self):
        """Execute read tasks"""
        read_task = ReadTasks(self.user)
        read_task.execute_task(random.choice([
            read_task.get_patient,
            read_task.get_diabetes_prediction,
            read_task.get_recommendations,
        ]))
    
    @task(5)
    def write_operations(self):
        """Execute write tasks"""
        write_task = WriteTasks(self.user)
        write_task.execute_task(random.choice([
            write_task.create_patient,
            write_task.create_lifestyle,
            write_task.predict_hypertension,
        ]))


# =============================================================================
# Test Scenarios
# =============================================================================

class BaselineTest(PredictHealthUser):
    """
    Baseline Test: Normal expected load
    - 50 concurrent users
    - Mixed read/write operations
    - Steady state for performance baseline
    """
    wait_time = between(1, 3)
    tasks = [MixedTasks]


class SmokeTest(PredictHealthUser):
    """
    Smoke Test: Minimal load to verify system works
    - 10 concurrent users
    - Quick verification (2-5 min)
    - All endpoints touched
    """
    wait_time = between(2, 5)
    tasks = [MixedTasks]


class ReadHeavyTest(PredictHealthUser):
    """
    Read-Heavy Test: 80% reads, 20% writes
    - Simulates typical CMS usage
    - Emphasis on GET endpoints
    """
    wait_time = between(1, 2)
    
    @task(80)
    def read_operations(self):
        # Pick a random read operation
        operation = random.choice([
            self.get_patient,
            self.get_diabetes_prediction,
            self.get_latest_diabetes,
            self.get_recommendations,
        ])
        operation()
    
    @task(20)
    def write_operations(self):
        # Pick a random write operation
        operation = random.choice([
            self.create_patient,
            self.create_lifestyle,
        ])
        operation()
    
    # Read operations
    def get_patient(self):
        if self.user_id:
            self.client.get(
                f"{get_service_url('patient')}/paciente/{self.user_id}",
                name="/paciente/{id} [GET]"
            )
    
    def get_diabetes_prediction(self):
        if self.user_id and self.access_token:
            self.client.get(
                f"{get_service_url('diabetes')}/predict_diabetes/{self.user_id}",
                headers=self.get_auth_headers(),
                name="/predict_diabetes/{id} [GET]"
            )
    
    def get_latest_diabetes(self):
        if self.user_id and self.access_token:
            self.client.get(
                f"{get_service_url('diabetes')}/prediccion/latest/diabetes/{self.user_id}",
                headers=self.get_auth_headers(),
                name="/prediccion/latest/diabetes/{id} [GET]"
            )
    
    def get_recommendations(self):
        if self.user_id and self.access_token:
            self.client.get(
                f"{get_service_url('recommendations')}/recommendations/{self.user_id}",
                headers=self.get_auth_headers(),
                name="/recommendations/{id} [GET]"
            )
    
    # Write operations
    def create_patient(self):
        if self.user_id and self.access_token:
            patient_data = SAMPLE_PATIENT.copy()
            patient_data["id_usuario"] = self.user_id
            self.client.post(
                f"{get_service_url('patient')}/paciente",
                json=patient_data,
                headers=self.get_auth_headers(),
                name="/paciente [POST]"
            )
    
    def create_lifestyle(self):
        if self.user_id and self.access_token:
            lifestyle_data = SAMPLE_LIFESTYLE.copy()
            lifestyle_data["id_usuario"] = self.user_id
            self.client.post(
                f"{get_service_url('health')}/estilo_vida",
                json=lifestyle_data,
                headers=self.get_auth_headers(),
                name="/estilo_vida [POST]"
            )


class WriteHeavyTest(PredictHealthUser):
    """
    Write-Heavy Test: 80% writes, 20% reads
    - Simulates data entry/update scenarios
    - Emphasis on POST endpoints
    - Tests database write capacity
    """
    wait_time = between(1, 3)
    
    @task(20)
    def read_operations(self):
        self.get_patient()
    
    @task(80)
    def write_operations(self):
        # Pick a random write operation
        operation = random.choice([
            self.create_patient,
            self.create_lifestyle,
            self.predict_hypertension,
            self.save_full_history,
        ])
        operation()
    
    # Read operation
    def get_patient(self):
        if self.user_id:
            self.client.get(
                f"{get_service_url('patient')}/paciente/{self.user_id}",
                name="/paciente/{id} [GET]"
            )
    
    # Write operations
    def create_patient(self):
        if self.user_id and self.access_token:
            patient_data = SAMPLE_PATIENT.copy()
            patient_data["id_usuario"] = self.user_id
            self.client.post(
                f"{get_service_url('patient')}/paciente",
                json=patient_data,
                headers=self.get_auth_headers(),
                name="/paciente [POST]"
            )
    
    def create_lifestyle(self):
        if self.user_id and self.access_token:
            lifestyle_data = SAMPLE_LIFESTYLE.copy()
            lifestyle_data["id_usuario"] = self.user_id
            self.client.post(
                f"{get_service_url('health')}/estilo_vida",
                json=lifestyle_data,
                headers=self.get_auth_headers(),
                name="/estilo_vida [POST]"
            )
    
    def predict_hypertension(self):
        if self.user_id and self.access_token:
            hypertension_data = SAMPLE_HYPERTENSION.copy()
            hypertension_data["id_usuario"] = self.user_id
            self.client.post(
                f"{get_service_url('hypertension')}/predict_hypertension",
                json=hypertension_data,
                headers=self.get_auth_headers(),
                name="/predict_hypertension [POST]"
            )
    
    def save_full_history(self):
        if self.user_id and self.access_token:
            full_data = SAMPLE_FULL_HISTORY.copy()
            full_data["id_usuario"] = self.user_id
            self.client.post(
                f"{get_service_url('data')}/guardar_historial",
                json=full_data,
                headers=self.get_auth_headers(),
                name="/guardar_historial [POST]"
            )

# Custom LoadTestShape classes are disabled for now
# Uncomment when you need progressive/custom load patterns
# class SpikeTestShape(LoadTestShape):
#     """
#     Spike Test Shape: Sudden traffic burst
#     - Normal: 50 users
#     - Spike: 200 users (sudden)
#     - Duration: 5 minutes
#     """
#     
#     def tick(self):
#         run_time = self.get_run_time()
#         
#         if run_time < 120:
#             # First 2 min: baseline 50 users
#             return (50, 10)
#         elif run_time < 180:
#             # Spike: jump to 200 users instantly
#             return (200, 50)
#         elif run_time < 240:
#             # Hold spike for 1 min
#             return (200, 50)
#         elif run_time < 300:
#             # Drop back to baseline
#             return (50, 50)
#         else:
#             return None


class SpikeTest(PredictHealthUser):
    """
    Spike Test: Sudden traffic burst
    - Use custom LoadTestShape for spike pattern
    - Tests system elasticity
    """
    wait_time = between(0.5, 1.5)
    tasks = [MixedTasks]


class SoakTest(PredictHealthUser):
    """
    Soak Test: Extended duration testing
    - Medium load over 1+ hours
    - Detects memory leaks, resource exhaustion
    - Run with: --run-time 1h or --run-time 4h
    """
    wait_time = between(2, 5)
    tasks = [MixedTasks]


# class BreakpointTestShape(LoadTestShape):
#     """
#     Breakpoint Test Shape: Progressive load increase
#     - Increments: +50 users every 2 minutes
#     - Continues until failure or manual stop
#     """
#     
#     def tick(self):
#         run_time = self.get_run_time()
#         
#         # Calculate user count based on elapsed time
#         step = int(run_time / 120)  # Every 2 minutes
#         user_count = 50 + (step * 50)  # Start at 50, add 50 every step
#         
#         # Cap at 1000 users (safety limit)
#         if user_count > 1000:
#             return None
#         
#         return (user_count, 10)


class BreakpointTest(PredictHealthUser):
    """
    Breakpoint Test: Find system limits
    - Use custom LoadTestShape for progressive load
    - Identify maximum capacity
    """
    wait_time = constant(1)
    tasks = [MixedTasks]


class CSVTest(PredictHealthUser):
    """
    CSV Test: Data-driven testing
    - Reads user credentials from users.csv
    - Each virtual user uses unique credentials
    
    Create users.csv:
        email,password
        user1@test.com,pass123
        user2@test.com,pass456
    """
    wait_time = between(1, 3)
    tasks = [MixedTasks]
    
    def __init__(self, *args, **kwargs):
        super().__init__(*args, **kwargs)
        self.csv_data = self.load_csv_data()
    
    @staticmethod
    def load_csv_data():
        """Load users from CSV file"""
        import os
        # Try multiple possible locations for users.csv
        possible_paths = [
            'testing/users.csv',  # From repo root
            'users.csv',          # From testing/ directory
            os.path.join(os.path.dirname(__file__), 'users.csv'),  # Relative to locustfile
        ]
        
        for csv_path in possible_paths:
            try:
                with open(csv_path, 'r') as f:
                    reader = csv.DictReader(f)
                    data = list(reader)
                    print(f"Loaded {len(data)} users from {csv_path}")
                    return data
            except FileNotFoundError:
                continue
        
        print("Warning: users.csv not found in any location, using default test users")
        return TEST_USERS
    
    def on_start(self):
        """Override login to use CSV data"""
        if self.csv_data:
            user_creds = random.choice(self.csv_data)
            
            response = self.client.post(
                f"{get_service_url('auth')}/auth/login",
                json={
                    "username": user_creds["email"],
                    "password": user_creds["password"]
                },
                name="/auth/login [CSV]"
            )
            
            if response.status_code == 200:
                data = response.json()
                self.access_token = data.get("access_token")
                self.user_email = user_creds["email"]
                
                if self.access_token:
                    me_response = self.client.get(
                        f"{get_service_url('auth')}/auth/me",
                        headers={"Authorization": f"Bearer {self.access_token}"},
                        name="/auth/me [CSV]"
                    )
                    if me_response.status_code == 200:
                        me_data = me_response.json()
                        self.user_id = int(me_data.get("sub", 1))
        else:
            super().on_start()


# =============================================================================
# Combined Test Classes with Shapes (SHAPES DISABLED)
# =============================================================================

# class RampUpTestShape(LoadTestShape):
#     """Ramp-Up Test: Gradual load increase"""
#     def tick(self):
#         run_time = self.get_run_time()
#         if run_time < 60: return (10, 5)
#         elif run_time < 120: return (20, 5)
#         elif run_time < 180: return (30, 5)
#         elif run_time < 240: return (40, 5)
#         elif run_time < 300: return (50, 5)
#         elif run_time < 360: return (60, 5)
#         elif run_time < 420: return (70, 5)
#         elif run_time < 480: return (80, 5)
#         elif run_time < 540: return (90, 5)
#         elif run_time < 600: return (100, 5)
#         else: return None


class RampUpTest(PredictHealthUser):
    """Ramp-up test (shapes disabled, use --users parameter)"""
    wait_time = between(1, 3)
    tasks = [MixedTasks]


# class RampDownTestShape(LoadTestShape):
#     """Ramp-Down Test: Gradual load decrease"""
#     def tick(self):
#         run_time = self.get_run_time()
#         if run_time < 60: return (100, 5)
#         elif run_time < 120: return (90, 5)
#         elif run_time < 180: return (80, 5)
#         elif run_time < 240: return (70, 5)
#         elif run_time < 300: return (60, 5)
#         elif run_time < 360: return (50, 5)
#         elif run_time < 420: return (40, 5)
#         elif run_time < 480: return (30, 5)
#         elif run_time < 540: return (20, 5)
#         elif run_time < 600: return (10, 5)
#         else: return None


class RampDownTest(PredictHealthUser):
    """Ramp-down test (shapes disabled, use --users parameter)"""
    wait_time = between(1, 3)
    tasks = [MixedTasks]


# =============================================================================
# Usage Examples
# =============================================================================

"""
Run Examples (Services use absolute URLs on ports 8001-8011):

1. Baseline Test (50 users, 10 min):
   locust -f locustfile.py BaselineTest --headless --users 50 --spawn-rate 5 --run-time 10m

2. Smoke Test (10 users, 2 min):
   locust -f locustfile.py SmokeTest --headless --users 10 --spawn-rate 2 --run-time 2m

3. Read-Heavy Test (100 users, 15 min):
   locust -f locustfile.py ReadHeavyTest --headless --users 100 --spawn-rate 10 --run-time 15m

4. Write-Heavy Test (50 users, 10 min):
   locust -f locustfile.py WriteHeavyTest --headless --users 50 --spawn-rate 5 --run-time 10m

5. Ramp-Up Test (with custom shape):
   locust -f locustfile.py RampUpTest --headless

6. Ramp-Down Test (with custom shape):
   locust -f locustfile.py RampDownTest --headless

7. Spike Test (with custom shape):
   locust -f locustfile.py SpikeTest --headless

8. Soak Test (100 users, 2 hours):
   locust -f locustfile.py SoakTest --headless --users 100 --spawn-rate 10 --run-time 2h

9. Breakpoint Test (progressive load):
   locust -f locustfile.py BreakpointTest --headless

10. CSV Test (data-driven):
    locust -f locustfile.py CSVTest --headless --users 50 --spawn-rate 10 --run-time 10m

11. Web UI (interactive):
    locust -f locustfile.py --host http://localhost
    # Then open http://localhost:8089

Generate HTML report:
    locust -f locustfile.py BaselineTest --headless --users 50 --spawn-rate 5 --run-time 5m --html report.html --host http://localhost
"""
</code></pre>
                </div>

                <h4>Script PowerShell para prueba Smoke (ejecución headless)</h4>
                <div class="code-preview">
                    <div class="code-header-bar">
                        <div class="code-language">PowerShell</div>
                    </div>
<pre class="code-display"><code># Smoke Test - Quick verification of all endpoints
param(
    [string]$OutputDir = "load_test_results"
)

$timestamp = Get-Date -Format "yyyyMMdd_HHmmss"
$resultsDir = "$OutputDir/smoke_$timestamp"
New-Item -ItemType Directory -Path $resultsDir -Force | Out-Null

Write-Host "Running Smoke Test..." -ForegroundColor Cyan
Write-Host "Results: $resultsDir" -ForegroundColor Green

locust -f testing/locustfile.py SmokeTest `
    --headless `
    --users 5 `
    --spawn-rate 5 `
    --run-time 1m `
    --html "$resultsDir/report.html" `
    --csv "$resultsDir/stats"

Write-Host "`nTest complete. Open $resultsDir/report.html to view results." -ForegroundColor Green
</code></pre>
                </div>

                <h4>Fragmentos de código relevantes</h4>
                <div class="code-preview">
                    <div class="code-header-bar">
                        <div class="code-language">Python (LoadTestShape)</div>
                    </div>
<pre class="code-display"><code># Custom LoadTestShape (deshabilitado por ahora)
# class SpikeTestShape(LoadTestShape):
#     """
#     Spike Test Shape: Sudden traffic burst
#     - Normal: 50 users
#     - Spike: 200 users (sudden)
#     - Duration: 5 minutes
#     """
#     def tick(self):
#         run_time = self.get_run_time()
#         if run_time < 120:
#             return (50, 10)      # 2 min baseline
#         elif run_time < 180:
#             return (200, 50)     # spike to 200
#         elif run_time < 240:
#             return (200, 50)     # hold spike
#         elif run_time < 300:
#             return (50, 50)      # drop to baseline
#         else:
#             return None
</code></pre>
                </div>

                <div class="code-preview">
                    <div class="code-header-bar">
                        <div class="code-language">Python (CSV feeder)</div>
                    </div>
<pre class="code-display"><code>class CSVTest(PredictHealthUser):
    """CSV Test: Data-driven testing"""
    wait_time = between(1, 3)
    tasks = [MixedTasks]

    def __init__(self, *args, **kwargs):
        super().__init__(*args, **kwargs)
        self.csv_data = self.load_csv_data()

    @staticmethod
    def load_csv_data():
        import os, csv
        possible_paths = [
            'testing/users.csv',
            'users.csv',
            os.path.join(os.path.dirname(__file__), 'users.csv'),
        ]
        for csv_path in possible_paths:
            try:
                with open(csv_path, 'r') as f:
                    return list(csv.DictReader(f))
            except FileNotFoundError:
                continue
        return TEST_USERS

    def on_start(self):
        if self.csv_data:
            user_creds = random.choice(self.csv_data)
            response = self.client.post(
                f"{get_service_url('auth')}/auth/login",
                json={"username": user_creds["email"], "password": user_creds["password"]},
                name="/auth/login [CSV]"
            )
            if response.status_code == 200:
                data = response.json()
                self.access_token = data.get("access_token")
                self.user_email = user_creds["email"]
</code></pre>
                </div>

                <h4>Archivo users.csv</h4>
                <div class="code-preview">
                    <div class="code-header-bar">
                        <div class="code-language">CSV</div>
                    </div>
<pre class="code-display"><code>email,password
user_1@cdc-diabetes.com,password123
user_2@cdc-diabetes.com,password123
user_3@cdc-diabetes.com,password123
user_4@cdc-diabetes.com,password123
user_5@cdc-diabetes.com,password123
user_6@cdc-diabetes.com,password123
user_7@cdc-diabetes.com,password123
user_8@cdc-diabetes.com,password123
user_9@cdc-diabetes.com,password123
user_10@cdc-diabetes.com,password123
user_11@cdc-diabetes.com,password123
user_12@cdc-diabetes.com,password123
user_13@cdc-diabetes.com,password123
user_14@cdc-diabetes.com,password123
user_15@cdc-diabetes.com,password123
user_16@cdc-diabetes.com,password123
user_17@cdc-diabetes.com,password123
user_18@cdc-diabetes.com,password123
user_19@cdc-diabetes.com,password123
user_20@cdc-diabetes.com,password123
user_21@cdc-diabetes.com,password123
user_22@cdc-diabetes.com,password123
user_23@cdc-diabetes.com,password123
user_24@cdc-diabetes.com,password123
user_25@cdc-diabetes.com,password123
user_26@cdc-diabetes.com,password123
user_27@cdc-diabetes.com,password123
user_28@cdc-diabetes.com,password123
user_29@cdc-diabetes.com,password123
user_30@cdc-diabetes.com,password123
user_31@cdc-diabetes.com,password123
user_32@cdc-diabetes.com,password123
user_33@cdc-diabetes.com,password123
user_34@cdc-diabetes.com,password123
user_35@cdc-diabetes.com,password123
user_36@cdc-diabetes.com,password123
user_37@cdc-diabetes.com,password123
user_38@cdc-diabetes.com,password123
user_39@cdc-diabetes.com,password123
user_40@cdc-diabetes.com,password123
user_41@cdc-diabetes.com,password123
user_42@cdc-diabetes.com,password123
user_43@cdc-diabetes.com,password123
user_44@cdc-diabetes.com,password123
user_45@cdc-diabetes.com,password123
user_46@cdc-diabetes.com,password123
user_47@cdc-diabetes.com,password123
user_48@cdc-diabetes.com,password123
user_49@cdc-diabetes.com,password123
user_50@cdc-diabetes.com,password123
user_51@cdc-diabetes.com,password123
user_52@cdc-diabetes.com,password123
user_53@cdc-diabetes.com,password123
user_54@cdc-diabetes.com,password123
user_55@cdc-diabetes.com,password123
user_56@cdc-diabetes.com,password123
user_57@cdc-diabetes.com,password123
user_58@cdc-diabetes.com,password123
user_59@cdc-diabetes.com,password123
user_60@cdc-diabetes.com,password123
user_61@cdc-diabetes.com,password123
user_62@cdc-diabetes.com,password123
user_63@cdc-diabetes.com,password123
user_64@cdc-diabetes.com,password123
user_65@cdc-diabetes.com,password123
user_66@cdc-diabetes.com,password123
user_67@cdc-diabetes.com,password123
user_68@cdc-diabetes.com,password123
user_69@cdc-diabetes.com,password123
user_70@cdc-diabetes.com,password123
user_71@cdc-diabetes.com,password123
user_72@cdc-diabetes.com,password123
user_73@cdc-diabetes.com,password123
user_74@cdc-diabetes.com,password123
user_75@cdc-diabetes.com,password123
user_76@cdc-diabetes.com,password123
user_77@cdc-diabetes.com,password123
user_78@cdc-diabetes.com,password123
user_79@cdc-diabetes.com,password123
user_80@cdc-diabetes.com,password123
user_81@cdc-diabetes.com,password123
user_82@cdc-diabetes.com,password123
user_83@cdc-diabetes.com,password123
user_84@cdc-diabetes.com,password123
user_85@cdc-diabetes.com,password123
user_86@cdc-diabetes.com,password123
user_87@cdc-diabetes.com,password123
user_88@cdc-diabetes.com,password123
user_89@cdc-diabetes.com,password123
user_90@cdc-diabetes.com,password123
user_91@cdc-diabetes.com,password123
user_92@cdc-diabetes.com,password123
user_93@cdc-diabetes.com,password123
user_94@cdc-diabetes.com,password123
user_95@cdc-diabetes.com,password123
user_96@cdc-diabetes.com,password123
user_97@cdc-diabetes.com,password123
user_98@cdc-diabetes.com,password123
user_99@cdc-diabetes.com,password123
user_100@cdc-diabetes.com,password123
user_1@hypertension-risk.com,password123
user_2@hypertension-risk.com,password123
user_3@hypertension-risk.com,password123
user_4@hypertension-risk.com,password123
user_5@hypertension-risk.com,password123
user_6@hypertension-risk.com,password123
user_7@hypertension-risk.com,password123
user_8@hypertension-risk.com,password123
user_9@hypertension-risk.com,password123
user_10@hypertension-risk.com,password123
user_11@hypertension-risk.com,password123
user_12@hypertension-risk.com,password123
user_13@hypertension-risk.com,password123
user_14@hypertension-risk.com,password123
user_15@hypertension-risk.com,password123
user_16@hypertension-risk.com,password123
user_17@hypertension-risk.com,password123
user_18@hypertension-risk.com,password123
user_19@hypertension-risk.com,password123
user_20@hypertension-risk.com,password123
user_21@hypertension-risk.com,password123
user_22@hypertension-risk.com,password123
user_23@hypertension-risk.com,password123
user_24@hypertension-risk.com,password123
user_25@hypertension-risk.com,password123
user_26@hypertension-risk.com,password123
user_27@hypertension-risk.com,password123
user_28@hypertension-risk.com,password123
user_29@hypertension-risk.com,password123
user_30@hypertension-risk.com,password123
user_31@hypertension-risk.com,password123
user_32@hypertension-risk.com,password123
user_33@hypertension-risk.com,password123
user_34@hypertension-risk.com,password123
user_35@hypertension-risk.com,password123
user_36@hypertension-risk.com,password123
user_37@hypertension-risk.com,password123
user_38@hypertension-risk.com,password123
user_39@hypertension-risk.com,password123
user_40@hypertension-risk.com,password123
user_41@hypertension-risk.com,password123
user_42@hypertension-risk.com,password123
user_43@hypertension-risk.com,password123
user_44@hypertension-risk.com,password123
user_45@hypertension-risk.com,password123
user_46@hypertension-risk.com,password123
user_47@hypertension-risk.com,password123
user_48@hypertension-risk.com,password123
user_49@hypertension-risk.com,password123
user_50@hypertension-risk.com,password123
user_51@hypertension-risk.com,password123
user_52@hypertension-risk.com,password123
user_53@hypertension-risk.com,password123
user_54@hypertension-risk.com,password123
user_55@hypertension-risk.com,password123
user_56@hypertension-risk.com,password123
user_57@hypertension-risk.com,password123
user_58@hypertension-risk.com,password123
user_59@hypertension-risk.com,password123
user_60@hypertension-risk.com,password123
user_61@hypertension-risk.com,password123
user_62@hypertension-risk.com,password123
user_63@hypertension-risk.com,password123
user_64@hypertension-risk.com,password123
user_65@hypertension-risk.com,password123
user_66@hypertension-risk.com,password123
user_67@hypertension-risk.com,password123
user_68@hypertension-risk.com,password123
user_69@hypertension-risk.com,password123
user_70@hypertension-risk.com,password123
user_71@hypertension-risk.com,password123
user_72@hypertension-risk.com,password123
user_73@hypertension-risk.com,password123
user_74@hypertension-risk.com,password123
user_75@hypertension-risk.com,password123
user_76@hypertension-risk.com,password123
user_77@hypertension-risk.com,password123
user_78@hypertension-risk.com,password123
user_79@hypertension-risk.com,password123
user_80@hypertension-risk.com,password123
user_81@hypertension-risk.com,password123
user_82@hypertension-risk.com,password123
user_83@hypertension-risk.com,password123
user_84@hypertension-risk.com,password123
user_85@hypertension-risk.com,password123
user_86@hypertension-risk.com,password123
user_87@hypertension-risk.com,password123
user_88@hypertension-risk.com,password123
user_89@hypertension-risk.com,password123
user_90@hypertension-risk.com,password123
user_91@hypertension-risk.com,password123
user_92@hypertension-risk.com,password123
user_93@hypertension-risk.com,password123
user_94@hypertension-risk.com,password123
user_95@hypertension-risk.com,password123
user_96@hypertension-risk.com,password123
user_97@hypertension-risk.com,password123
user_98@hypertension-risk.com,password123
user_99@hypertension-risk.com,password123
user_100@hypertension-risk.com,password123
</code></pre>
                </div>
            </div>

            <div class="exercise-info">
                <h3>Resultados</h3>

                <ol>
                    <li><strong>Tablas comparativas de métricas clave:</strong>
    <div class="table-card">
        <div class="table-title">stats_exceptions.csv</div>
        <div class="table-responsive">
            <table class="results-table">
                <thead><tr><th>Count</th><th>Message</th><th>Traceback</th><th>Nodes</th></tr></thead>
                <tbody><tr></tr></tbody>
            </table>
        </div>
    </div>
    <div class="table-card">
        <div class="table-title">stats_failures.csv</div>
        <div class="table-responsive">
            <table class="results-table">
                <thead><tr><th>Method</th><th>Name</th><th>Error</th><th>Occurrences</th></tr></thead>
                <tbody><tr></tr></tbody>
            </table>
        </div>
    </div>
    <div class="table-card">
        <div class="table-title">stats_stats.csv</div>
        <div class="table-responsive">
            <table class="results-table">
                <thead><tr><th>Type</th><th>Name</th><th>Request Count</th><th>Failure Count</th><th>Median Response Time</th><th>Average Response Time</th><th>Min Response Time</th><th>Max Response Time</th><th>Average Content Size</th><th>Requests/s</th><th>Failures/s</th><th>50%</th><th>66%</th><th>75%</th><th>80%</th><th>90%</th><th>95%</th><th>98%</th><th>99%</th><th>99.9%</th><th>99.99%</th><th>100%</th></tr></thead>
                <tbody><tr></tr>
<tr><td>POST</td><td>/auth/login</td><td>5</td><td>0</td><td>4708.5647999774665</td><td>5123.138320003636</td><td>4708.5647999774665</td><td>6036.693000001833</td><td>856.2</td><td>0.08637106430964253</td><td>0.0</td><td>4700</td><td>5400</td><td>5400</td><td>6000</td><td>6000</td><td>6000</td><td>6000</td><td>6000</td><td>6000</td><td>6000</td><td>6000</td></tr>
<tr></tr>
<tr><td>GET</td><td>/auth/me</td><td>5</td><td>0</td><td>5</td><td>392.8550800308585</td><td>2.0343000069260597</td><td>1300.457900040783</td><td>178.6</td><td>0.08637106430964253</td><td>0.0</td><td>5</td><td>650</td><td>650</td><td>1300</td><td>1300</td><td>1300</td><td>1300</td><td>1300</td><td>1300</td><td>1300</td><td>1300</td></tr>
<tr></tr>
<tr><td>POST</td><td>/estilo_vida [POST]</td><td>8</td><td>0</td><td>2100.0</td><td>2384.048924985109</td><td>45.70939997211099</td><td>4266.967299976386</td><td>41.625</td><td>0.13819370289542804</td><td>0.0</td><td>2100</td><td>2200</td><td>4200</td><td>4200</td><td>4300</td><td>4300</td><td>4300</td><td>4300</td><td>4300</td><td>4300</td><td>4300</td></tr>
<tr></tr>
<tr><td>POST</td><td>/paciente [POST]</td><td>5</td><td>0</td><td>2100.0</td><td>2092.6111599896103</td><td>41.171499993652105</td><td>4150.759599986486</td><td>29.8</td><td>0.08637106430964253</td><td>0.0</td><td>2100</td><td>4100</td><td>4100</td><td>4200</td><td>4200</td><td>4200</td><td>4200</td><td>4200</td><td>4200</td><td>4200</td><td>4200</td></tr>
<tr></tr>
<tr><td>GET</td><td>/paciente/{id} [GET]</td><td>10</td><td>0</td><td>2100.0</td><td>1909.385880024638</td><td>140.90180001221597</td><td>2205.178300035186</td><td>141.4</td><td>0.17274212861928506</td><td>0.0</td><td>2100</td><td>2100</td><td>2100</td><td>2100</td><td>2200</td><td>2200</td><td>2200</td><td>2200</td><td>2200</td><td>2200</td><td>2200</td></tr>
<tr></tr>
<tr><td>GET</td><td>/predict_diabetes/{id} [GET]</td><td>10</td><td>0</td><td>2200.0</td><td>2584.6191599965096</td><td>108.4517000708729</td><td>4227.5737000163645</td><td>134.6</td><td>0.17274212861928506</td><td>0.0</td><td>2200</td><td>4200</td><td>4200</td><td>4200</td><td>4200</td><td>4200</td><td>4200</td><td>4200</td><td>4200</td><td>4200</td><td>4200</td></tr>
<tr></tr>
<tr><td>POST</td><td>/predict_hypertension [POST]</td><td>8</td><td>0</td><td>2100.0</td><td>2133.213324996177</td><td>64.25850000232458</td><td>4176.184999989346</td><td>129.5</td><td>0.13819370289542804</td><td>0.0</td><td>2100</td><td>2200</td><td>4200</td><td>4200</td><td>4200</td><td>4200</td><td>4200</td><td>4200</td><td>4200</td><td>4200</td><td>4200</td></tr>
<tr></tr>
<tr><td>GET</td><td>/recommendations/{id} [GET]</td><td>6</td><td>0</td><td>2100.0</td><td>2092.4792833199413</td><td>41.49109998252243</td><td>4143.758799997158</td><td>81.5</td><td>0.10364527717157103</td><td>0.0</td><td>2100</td><td>2100</td><td>4100</td><td>4100</td><td>4100</td><td>4100</td><td>4100</td><td>4100</td><td>4100</td><td>4100</td><td>4100</td></tr>
<tr></tr>
<tr><td></td><td>Aggregated</td><td>57</td><td>0</td><td>2100.0</td><td>2310.1060859667004</td><td>2.0343000069260597</td><td>6036.693000001833</td><td>174.40350877192984</td><td>0.9846301331299248</td><td>0.0</td><td>2100</td><td>2200</td><td>4100</td><td>4200</td><td>4300</td><td>4700</td><td>5400</td><td>6000</td><td>6000</td><td>6000</td><td>6000</td></tr>
<tr></tr></tbody>
            </table>
        </div>
    </div>
    <div class="table-card">
        <div class="table-title">stats_stats_history.csv</div>
        <div class="table-responsive scrollable">
            <table class="results-table">
                <thead><tr><th>Timestamp</th><th>User Count</th><th>Type</th><th>Name</th><th>Requests/s</th><th>Failures/s</th><th>50%</th><th>66%</th><th>75%</th><th>80%</th><th>90%</th><th>95%</th><th>98%</th><th>99%</th><th>99.9%</th><th>99.99%</th><th>100%</th><th>Total Request Count</th><th>Total Failure Count</th><th>Total Median Response Time</th><th>Total Average Response Time</th><th>Total Min Response Time</th><th>Total Max Response Time</th><th>Total Average Content Size</th></tr></thead>
                <tbody><tr></tr>
<tr><td>1763954891</td><td>0</td><td></td><td>Aggregated</td><td>0.000000</td><td>0.000000</td><td>N/A</td><td>N/A</td><td>N/A</td><td>N/A</td><td>N/A</td><td>N/A</td><td>N/A</td><td>N/A</td><td>N/A</td><td>N/A</td><td>N/A</td><td>0</td><td>0</td><td>0</td><td>0.0</td><td>0</td><td>0</td><td>0</td></tr>
<tr></tr>
<tr><td>1763954892</td><td>5</td><td></td><td>Aggregated</td><td>0.000000</td><td>0.000000</td><td>N/A</td><td>N/A</td><td>N/A</td><td>N/A</td><td>N/A</td><td>N/A</td><td>N/A</td><td>N/A</td><td>N/A</td><td>N/A</td><td>N/A</td><td>0</td><td>0</td><td>0</td><td>0.0</td><td>0</td><td>0</td><td>0</td></tr>
<tr></tr>
<tr><td>1763954893</td><td>5</td><td></td><td>Aggregated</td><td>0.000000</td><td>0.000000</td><td>N/A</td><td>N/A</td><td>N/A</td><td>N/A</td><td>N/A</td><td>N/A</td><td>N/A</td><td>N/A</td><td>N/A</td><td>N/A</td><td>N/A</td><td>0</td><td>0</td><td>0</td><td>0.0</td><td>0</td><td>0</td><td>0</td></tr>
<tr></tr>
<tr><td>1763954894</td><td>5</td><td></td><td>Aggregated</td><td>0.000000</td><td>0.000000</td><td>N/A</td><td>N/A</td><td>N/A</td><td>N/A</td><td>N/A</td><td>N/A</td><td>N/A</td><td>N/A</td><td>N/A</td><td>N/A</td><td>N/A</td><td>0</td><td>0</td><td>0</td><td>0.0</td><td>0</td><td>0</td><td>0</td></tr>
<tr></tr>
<tr><td>1763954895</td><td>5</td><td></td><td>Aggregated</td><td>0.000000</td><td>0.000000</td><td>N/A</td><td>N/A</td><td>N/A</td><td>N/A</td><td>N/A</td><td>N/A</td><td>N/A</td><td>N/A</td><td>N/A</td><td>N/A</td><td>N/A</td><td>0</td><td>0</td><td>0</td><td>0.0</td><td>0</td><td>0</td><td>0</td></tr>
<tr></tr>
<tr><td>1763954896</td><td>5</td><td></td><td>Aggregated</td><td>0.000000</td><td>0.000000</td><td>4700</td><td>4700</td><td>4700</td><td>4700</td><td>4700</td><td>4700</td><td>4700</td><td>4700</td><td>4700</td><td>4700</td><td>4700</td><td>5</td><td>0</td><td>4700.0</td><td>2839.4105799961835</td><td>2.0343000069260597</td><td>4745.997300022282</td><td>580.2</td></tr>
<tr></tr>
<tr><td>1763954897</td><td>5</td><td></td><td>Aggregated</td><td>0.000000</td><td>0.000000</td><td>4700</td><td>4700</td><td>5400</td><td>5400</td><td>6000</td><td>6000</td><td>6000</td><td>6000</td><td>6000</td><td>6000</td><td>6000</td><td>7</td><td>0</td><td>4700.0</td><td>3660.0264285724343</td><td>2.0343000069260597</td><td>6036.693000001833</td><td>661.5714285714286</td></tr>
<tr></tr>
<tr><td>1763954898</td><td>5</td><td></td><td>Aggregated</td><td>0.000000</td><td>0.000000</td><td>4700</td><td>4700</td><td>4700</td><td>5400</td><td>6000</td><td>6000</td><td>6000</td><td>6000</td><td>6000</td><td>6000</td><td>6000</td><td>10</td><td>0</td><td>1300.0</td><td>2757.9967000172473</td><td>2.0343000069260597</td><td>6036.693000001833</td><td>517.4</td></tr>
<tr></tr>
<tr><td>1763954899</td><td>5</td><td></td><td>Aggregated</td><td>0.000000</td><td>0.000000</td><td>4700</td><td>4700</td><td>4700</td><td>5400</td><td>6000</td><td>6000</td><td>6000</td><td>6000</td><td>6000</td><td>6000</td><td>6000</td><td>10</td><td>0</td><td>1300.0</td><td>2757.9967000172473</td><td>2.0343000069260597</td><td>6036.693000001833</td><td>517.4</td></tr>
<tr></tr>
<tr><td>1763954900</td><td>5</td><td></td><td>Aggregated</td><td>1.428571</td><td>0.000000</td><td>4100</td><td>4700</td><td>4700</td><td>4700</td><td>5400</td><td>6000</td><td>6000</td><td>6000</td><td>6000</td><td>6000</td><td>6000</td><td>13</td><td>0</td><td>4100.0</td><td>2922.2431923262775</td><td>2.0343000069260597</td><td>6036.693000001833</td><td>425.0769230769231</td></tr>
<tr></tr>
<tr><td>1763954901</td><td>5</td><td></td><td>Aggregated</td><td>1.428571</td><td>0.000000</td><td>4100</td><td>4700</td><td>4700</td><td>4700</td><td>5400</td><td>6000</td><td>6000</td><td>6000</td><td>6000</td><td>6000</td><td>6000</td><td>13</td><td>0</td><td>4100.0</td><td>2922.2431923262775</td><td>2.0343000069260597</td><td>6036.693000001833</td><td>425.0769230769231</td></tr>
<tr></tr>
<tr><td>1763954902</td><td>5</td><td></td><td>Aggregated</td><td>1.250000</td><td>0.000000</td><td>4200</td><td>4200</td><td>4700</td><td>4700</td><td>5400</td><td>6000</td><td>6000</td><td>6000</td><td>6000</td><td>6000</td><td>6000</td><td>15</td><td>0</td><td>4200.0</td><td>3092.4751066835597</td><td>2.0343000069260597</td><td>6036.693000001833</td><td>386.06666666666666</td></tr>
<tr></tr>
<tr><td>1763954903</td><td>5</td><td></td><td>Aggregated</td><td>1.250000</td><td>0.000000</td><td>4200</td><td>4200</td><td>4700</td><td>4700</td><td>5400</td><td>6000</td><td>6000</td><td>6000</td><td>6000</td><td>6000</td><td>6000</td><td>15</td><td>0</td><td>4200.0</td><td>3092.4751066835597</td><td>2.0343000069260597</td><td>6036.693000001833</td><td>386.06666666666666</td></tr>
<tr></tr>
<tr><td>1763954904</td><td>5</td><td></td><td>Aggregated</td><td>1.500000</td><td>0.000000</td><td>4200</td><td>4200</td><td>4700</td><td>4700</td><td>5400</td><td>6000</td><td>6000</td><td>6000</td><td>6000</td><td>6000</td><td>6000</td><td>16</td><td>0</td><td>4100.0</td><td>2903.433506267902</td><td>2.0343000069260597</td><td>6036.693000001833</td><td>370.0</td></tr>
<tr></tr>
<tr><td>1763954905</td><td>5</td><td></td><td>Aggregated</td><td>1.500000</td><td>0.000000</td><td>4200</td><td>4200</td><td>4700</td><td>4700</td><td>5400</td><td>6000</td><td>6000</td><td>6000</td><td>6000</td><td>6000</td><td>6000</td><td>16</td><td>0</td><td>4100.0</td><td>2903.433506267902</td><td>2.0343000069260597</td><td>6036.693000001833</td><td>370.0</td></tr>
<tr></tr>
<tr><td>1763954906</td><td>5</td><td></td><td>Aggregated</td><td>1.500000</td><td>0.000000</td><td>4200</td><td>4200</td><td>4700</td><td>4700</td><td>5400</td><td>6000</td><td>6000</td><td>6000</td><td>6000</td><td>6000</td><td>6000</td><td>18</td><td>0</td><td>4100.0</td><td>2933.5729944610243</td><td>2.0343000069260597</td><td>6036.693000001833</td><td>343.6111111111111</td></tr>
<tr></tr>
<tr><td>1763954907</td><td>5</td><td></td><td>Aggregated</td><td>1.500000</td><td>0.000000</td><td>4100</td><td>4200</td><td>4700</td><td>4700</td><td>5400</td><td>6000</td><td>6000</td><td>6000</td><td>6000</td><td>6000</td><td>6000</td><td>20</td><td>0</td><td>2100.0</td><td>2849.8075050185435</td><td>2.0343000069260597</td><td>6036.693000001833</td><td>323.35</td></tr>
<tr></tr>
<tr><td>1763954908</td><td>5</td><td></td><td>Aggregated</td><td>1.500000</td><td>0.000000</td><td>4100</td><td>4200</td><td>4700</td><td>4700</td><td>5400</td><td>6000</td><td>6000</td><td>6000</td><td>6000</td><td>6000</td><td>6000</td><td>20</td><td>0</td><td>2100.0</td><td>2849.8075050185435</td><td>2.0343000069260597</td><td>6036.693000001833</td><td>323.35</td></tr>
<tr></tr>
<tr><td>1763954909</td><td>5</td><td></td><td>Aggregated</td><td>1.400000</td><td>0.000000</td><td>2100</td><td>4200</td><td>4200</td><td>4700</td><td>4700</td><td>5400</td><td>6000</td><td>6000</td><td>6000</td><td>6000</td><td>6000</td><td>22</td><td>0</td><td>2100.0</td><td>2600.0595636538824</td><td>2.0343000069260597</td><td>6036.693000001833</td><td>306.27272727272725</td></tr>
<tr></tr>
<tr><td>1763954910</td><td>5</td><td></td><td>Aggregated</td><td>1.400000</td><td>0.000000</td><td>2100</td><td>4200</td><td>4200</td><td>4700</td><td>4700</td><td>5400</td><td>6000</td><td>6000</td><td>6000</td><td>6000</td><td>6000</td><td>22</td><td>0</td><td>2100.0</td><td>2600.0595636538824</td><td>2.0343000069260597</td><td>6036.693000001833</td><td>306.27272727272725</td></tr>
<tr></tr>
<tr><td>1763954911</td><td>5</td><td></td><td>Aggregated</td><td>1.000000</td><td>0.000000</td><td>2100</td><td>4200</td><td>4200</td><td>4700</td><td>4700</td><td>5400</td><td>6000</td><td>6000</td><td>6000</td><td>6000</td><td>6000</td><td>23</td><td>0</td><td>2100.0</td><td>2582.890813061765</td><td>2.0343000069260597</td><td>6036.693000001833</td><td>299.1304347826087</td></tr>
<tr></tr>
<tr><td>1763954912</td><td>5</td><td></td><td>Aggregated</td><td>1.100000</td><td>0.000000</td><td>2200</td><td>4200</td><td>4200</td><td>4700</td><td>4700</td><td>5400</td><td>6000</td><td>6000</td><td>6000</td><td>6000</td><td>6000</td><td>24</td><td>0</td><td>2100.0</td><td>2647.748733351667</td><td>2.0343000069260597</td><td>6036.693000001833</td><td>287.9166666666667</td></tr>
<tr></tr>
<tr><td>1763954913</td><td>5</td><td></td><td>Aggregated</td><td>1.100000</td><td>0.000000</td><td>2200</td><td>4200</td><td>4200</td><td>4700</td><td>4700</td><td>5400</td><td>6000</td><td>6000</td><td>6000</td><td>6000</td><td>6000</td><td>24</td><td>0</td><td>2100.0</td><td>2647.748733351667</td><td>2.0343000069260597</td><td>6036.693000001833</td><td>287.9166666666667</td></tr>
<tr></tr>
<tr><td>1763954914</td><td>5</td><td></td><td>Aggregated</td><td>1.100000</td><td>0.000000</td><td>2200</td><td>4200</td><td>4200</td><td>4700</td><td>4700</td><td>5400</td><td>6000</td><td>6000</td><td>6000</td><td>6000</td><td>6000</td><td>24</td><td>0</td><td>2100.0</td><td>2647.748733351667</td><td>2.0343000069260597</td><td>6036.693000001833</td><td>287.9166666666667</td></tr>
<tr></tr>
<tr><td>1763954915</td><td>5</td><td></td><td>Aggregated</td><td>0.900000</td><td>0.000000</td><td>2100</td><td>4200</td><td>4200</td><td>4700</td><td>4700</td><td>5400</td><td>6000</td><td>6000</td><td>6000</td><td>6000</td><td>6000</td><td>25</td><td>0</td><td>2100.0</td><td>2627.8259240137413</td><td>2.0343000069260597</td><td>6036.693000001833</td><td>281.76</td></tr>
<tr></tr>
<tr><td>1763954916</td><td>5</td><td></td><td>Aggregated</td><td>0.900000</td><td>0.000000</td><td>2200</td><td>4200</td><td>4200</td><td>4200</td><td>4700</td><td>5400</td><td>6000</td><td>6000</td><td>6000</td><td>6000</td><td>6000</td><td>26</td><td>0</td><td>2100.0</td><td>2688.9238961649917</td><td>2.0343000069260597</td><td>6036.693000001833</td><td>276.0769230769231</td></tr>
<tr></tr>
<tr><td>1763954917</td><td>5</td><td></td><td>Aggregated</td><td>0.800000</td><td>0.000000</td><td>2200</td><td>4200</td><td>4200</td><td>4200</td><td>4700</td><td>5400</td><td>6000</td><td>6000</td><td>6000</td><td>6000</td><td>6000</td><td>27</td><td>0</td><td>2200.0</td><td>2743.3755888983055</td><td>2.0343000069260597</td><td>6036.693000001833</td><td>267.4074074074074</td></tr>
<tr></tr>
<tr><td>1763954918</td><td>5</td><td></td><td>Aggregated</td><td>1.000000</td><td>0.000000</td><td>4100</td><td>4200</td><td>4200</td><td>4200</td><td>4700</td><td>5400</td><td>6000</td><td>6000</td><td>6000</td><td>6000</td><td>6000</td><td>28</td><td>0</td><td>2200.0</td><td>2796.300696437746</td><td>2.0343000069260597</td><td>6036.693000001833</td><td>262.67857142857144</td></tr>
<tr></tr>
<tr><td>1763954919</td><td>5</td><td></td><td>Aggregated</td><td>0.600000</td><td>0.000000</td><td>2200</td><td>4200</td><td>4200</td><td>4200</td><td>4700</td><td>5400</td><td>6000</td><td>6000</td><td>6000</td><td>6000</td><td>6000</td><td>29</td><td>0</td><td>2200.0</td><td>2701.4527206975517</td><td>2.0343000069260597</td><td>6036.693000001833</td><td>255.06896551724137</td></tr>
<tr></tr>
<tr><td>1763954920</td><td>5</td><td></td><td>Aggregated</td><td>0.600000</td><td>0.000000</td><td>2200</td><td>4200</td><td>4200</td><td>4200</td><td>4700</td><td>5400</td><td>6000</td><td>6000</td><td>6000</td><td>6000</td><td>6000</td><td>29</td><td>0</td><td>2200.0</td><td>2701.4527206975517</td><td>2.0343000069260597</td><td>6036.693000001833</td><td>255.06896551724137</td></tr>
<tr></tr>
<tr><td>1763954921</td><td>5</td><td></td><td>Aggregated</td><td>0.800000</td><td>0.000000</td><td>2200</td><td>4200</td><td>4200</td><td>4200</td><td>4700</td><td>5400</td><td>6000</td><td>6000</td><td>6000</td><td>6000</td><td>6000</td><td>31</td><td>0</td><td>2200.0</td><td>2732.4698903304975</td><td>2.0343000069260597</td><td>6036.693000001833</td><td>241.29032258064515</td></tr>
<tr></tr>
<tr><td>1763954922</td><td>5</td><td></td><td>Aggregated</td><td>0.800000</td><td>0.000000</td><td>2200</td><td>4200</td><td>4200</td><td>4200</td><td>4700</td><td>5400</td><td>6000</td><td>6000</td><td>6000</td><td>6000</td><td>6000</td><td>31</td><td>0</td><td>2200.0</td><td>2732.4698903304975</td><td>2.0343000069260597</td><td>6036.693000001833</td><td>241.29032258064515</td></tr>
<tr></tr>
<tr><td>1763954923</td><td>5</td><td></td><td>Aggregated</td><td>0.700000</td><td>0.000000</td><td>2200</td><td>4200</td><td>4200</td><td>4200</td><td>4700</td><td>5400</td><td>6000</td><td>6000</td><td>6000</td><td>6000</td><td>6000</td><td>33</td><td>0</td><td>2200.0</td><td>2637.431242432671</td><td>2.0343000069260597</td><td>6036.693000001833</td><td>232.0</td></tr>
<tr></tr>
<tr><td>1763954924</td><td>5</td><td></td><td>Aggregated</td><td>0.700000</td><td>0.000000</td><td>2200</td><td>4200</td><td>4200</td><td>4200</td><td>4700</td><td>5400</td><td>6000</td><td>6000</td><td>6000</td><td>6000</td><td>6000</td><td>33</td><td>0</td><td>2200.0</td><td>2637.431242432671</td><td>2.0343000069260597</td><td>6036.693000001833</td><td>232.0</td></tr>
<tr></tr>
<tr><td>1763954925</td><td>5</td><td></td><td>Aggregated</td><td>0.700000</td><td>0.000000</td><td>2200</td><td>4200</td><td>4200</td><td>4200</td><td>4700</td><td>5400</td><td>6000</td><td>6000</td><td>6000</td><td>6000</td><td>6000</td><td>33</td><td>0</td><td>2200.0</td><td>2637.431242432671</td><td>2.0343000069260597</td><td>6036.693000001833</td><td>232.0</td></tr>
<tr></tr>
<tr><td>1763954926</td><td>5</td><td></td><td>Aggregated</td><td>0.700000</td><td>0.000000</td><td>2200</td><td>4200</td><td>4200</td><td>4200</td><td>4700</td><td>5400</td><td>6000</td><td>6000</td><td>6000</td><td>6000</td><td>6000</td><td>33</td><td>0</td><td>2200.0</td><td>2637.431242432671</td><td>2.0343000069260597</td><td>6036.693000001833</td><td>232.0</td></tr>
<tr></tr>
<tr><td>1763954927</td><td>5</td><td></td><td>Aggregated</td><td>0.900000</td><td>0.000000</td><td>2200</td><td>4200</td><td>4200</td><td>4200</td><td>4700</td><td>5400</td><td>6000</td><td>6000</td><td>6000</td><td>6000</td><td>6000</td><td>34</td><td>0</td><td>2200.0</td><td>2623.2872000066836</td><td>2.0343000069260597</td><td>6036.693000001833</td><td>229.14705882352942</td></tr>
<tr></tr>
<tr><td>1763954928</td><td>5</td><td></td><td>Aggregated</td><td>0.700000</td><td>0.000000</td><td>2200</td><td>4200</td><td>4200</td><td>4200</td><td>4700</td><td>5400</td><td>6000</td><td>6000</td><td>6000</td><td>6000</td><td>6000</td><td>36</td><td>0</td><td>2200.0</td><td>2651.0035305594406</td><td>2.0343000069260597</td><td>6036.693000001833</td><td>218.41666666666666</td></tr>
<tr></tr>
<tr><td>1763954929</td><td>5</td><td></td><td>Aggregated</td><td>0.700000</td><td>0.000000</td><td>2200</td><td>4200</td><td>4200</td><td>4200</td><td>4700</td><td>5400</td><td>6000</td><td>6000</td><td>6000</td><td>6000</td><td>6000</td><td>37</td><td>0</td><td>2200.0</td><td>2635.796148650902</td><td>2.0343000069260597</td><td>6036.693000001833</td><td>213.2972972972973</td></tr>
<tr></tr>
<tr><td>1763954930</td><td>5</td><td></td><td>Aggregated</td><td>0.700000</td><td>0.000000</td><td>2200</td><td>4200</td><td>4200</td><td>4200</td><td>4700</td><td>5400</td><td>6000</td><td>6000</td><td>6000</td><td>6000</td><td>6000</td><td>38</td><td>0</td><td>2200.0</td><td>2675.4307894734666</td><td>2.0343000069260597</td><td>6036.693000001833</td><td>209.81578947368422</td></tr>
<tr></tr>
<tr><td>1763954931</td><td>5</td><td></td><td>Aggregated</td><td>0.700000</td><td>0.000000</td><td>2200</td><td>4200</td><td>4200</td><td>4200</td><td>4700</td><td>5400</td><td>6000</td><td>6000</td><td>6000</td><td>6000</td><td>6000</td><td>38</td><td>0</td><td>2200.0</td><td>2675.4307894734666</td><td>2.0343000069260597</td><td>6036.693000001833</td><td>209.81578947368422</td></tr>
<tr></tr>
<tr><td>1763954932</td><td>5</td><td></td><td>Aggregated</td><td>0.900000</td><td>0.000000</td><td>2200</td><td>4200</td><td>4200</td><td>4200</td><td>4700</td><td>5400</td><td>6000</td><td>6000</td><td>6000</td><td>6000</td><td>6000</td><td>39</td><td>0</td><td>2200.0</td><td>2607.893874358314</td><td>2.0343000069260597</td><td>6036.693000001833</td><td>206.51282051282053</td></tr>
<tr></tr>
<tr><td>1763954933</td><td>5</td><td></td><td>Aggregated</td><td>0.900000</td><td>0.000000</td><td>2200</td><td>4200</td><td>4200</td><td>4200</td><td>4700</td><td>4700</td><td>6000</td><td>6000</td><td>6000</td><td>6000</td><td>6000</td><td>41</td><td>0</td><td>2200.0</td><td>2586.06066341262</td><td>2.0343000069260597</td><td>6036.693000001833</td><td>203.0731707317073</td></tr>
<tr></tr>
<tr><td>1763954934</td><td>5</td><td></td><td>Aggregated</td><td>0.700000</td><td>0.000000</td><td>2200</td><td>4100</td><td>4200</td><td>4200</td><td>4700</td><td>4700</td><td>6000</td><td>6000</td><td>6000</td><td>6000</td><td>6000</td><td>43</td><td>0</td><td>2200.0</td><td>2564.9645558130646</td><td>2.0343000069260597</td><td>6036.693000001833</td><td>198.65116279069767</td></tr>
<tr></tr>
<tr><td>1763954935</td><td>5</td><td></td><td>Aggregated</td><td>0.700000</td><td>0.000000</td><td>2200</td><td>4100</td><td>4200</td><td>4200</td><td>4700</td><td>4700</td><td>6000</td><td>6000</td><td>6000</td><td>6000</td><td>6000</td><td>43</td><td>0</td><td>2200.0</td><td>2564.9645558130646</td><td>2.0343000069260597</td><td>6036.693000001833</td><td>198.65116279069767</td></tr>
<tr></tr>
<tr><td>1763954936</td><td>5</td><td></td><td>Aggregated</td><td>0.600000</td><td>0.000000</td><td>2200</td><td>4100</td><td>4200</td><td>4200</td><td>4700</td><td>4700</td><td>6000</td><td>6000</td><td>6000</td><td>6000</td><td>6000</td><td>44</td><td>0</td><td>2100.0</td><td>2507.6056227262598</td><td>2.0343000069260597</td><td>6036.693000001833</td><td>194.8181818181818</td></tr>
<tr></tr>
<tr><td>1763954937</td><td>5</td><td></td><td>Aggregated</td><td>1.000000</td><td>0.000000</td><td>2100</td><td>4100</td><td>4200</td><td>4200</td><td>4700</td><td>4700</td><td>6000</td><td>6000</td><td>6000</td><td>6000</td><td>6000</td><td>46</td><td>0</td><td>2100.0</td><td>2444.892519563639</td><td>2.0343000069260597</td><td>6036.693000001833</td><td>191.17391304347825</td></tr>
<tr></tr>
<tr><td>1763954938</td><td>5</td><td></td><td>Aggregated</td><td>1.000000</td><td>0.000000</td><td>2100</td><td>4100</td><td>4200</td><td>4200</td><td>4700</td><td>4700</td><td>6000</td><td>6000</td><td>6000</td><td>6000</td><td>6000</td><td>47</td><td>0</td><td>2100.0</td><td>2397.191702125673</td><td>2.0343000069260597</td><td>6036.693000001833</td><td>189.95744680851064</td></tr>
<tr></tr>
<tr><td>1763954939</td><td>5</td><td></td><td>Aggregated</td><td>1.100000</td><td>0.000000</td><td>2100</td><td>4100</td><td>4200</td><td>4200</td><td>4700</td><td>4700</td><td>6000</td><td>6000</td><td>6000</td><td>6000</td><td>6000</td><td>48</td><td>0</td><td>2100.0</td><td>2390.742049998759</td><td>2.0343000069260597</td><td>6036.693000001833</td><td>188.95833333333334</td></tr>
<tr></tr>
<tr><td>1763954940</td><td>5</td><td></td><td>Aggregated</td><td>1.100000</td><td>0.000000</td><td>2100</td><td>4100</td><td>4200</td><td>4200</td><td>4700</td><td>4700</td><td>6000</td><td>6000</td><td>6000</td><td>6000</td><td>6000</td><td>48</td><td>0</td><td>2100.0</td><td>2390.742049998759</td><td>2.0343000069260597</td><td>6036.693000001833</td><td>188.95833333333334</td></tr>
<tr></tr>
<tr><td>1763954941</td><td>5</td><td></td><td>Aggregated</td><td>1.000000</td><td>0.000000</td><td>2100</td><td>4100</td><td>4200</td><td>4200</td><td>4700</td><td>4700</td><td>6000</td><td>6000</td><td>6000</td><td>6000</td><td>6000</td><td>50</td><td>0</td><td>2100.0</td><td>2378.8526119990274</td><td>2.0343000069260597</td><td>6036.693000001833</td><td>183.88</td></tr>
<tr></tr>
<tr><td>1763954942</td><td>5</td><td></td><td>Aggregated</td><td>1.000000</td><td>0.000000</td><td>2100</td><td>4100</td><td>4200</td><td>4200</td><td>4700</td><td>4700</td><td>6000</td><td>6000</td><td>6000</td><td>6000</td><td>6000</td><td>50</td><td>0</td><td>2100.0</td><td>2378.8526119990274</td><td>2.0343000069260597</td><td>6036.693000001833</td><td>183.88</td></tr>
<tr></tr>
<tr><td>1763954943</td><td>5</td><td></td><td>Aggregated</td><td>1.000000</td><td>0.000000</td><td>2100</td><td>2200</td><td>4200</td><td>4200</td><td>4300</td><td>4700</td><td>5400</td><td>6000</td><td>6000</td><td>6000</td><td>6000</td><td>51</td><td>0</td><td>2100.0</td><td>2373.2055764709253</td><td>2.0343000069260597</td><td>6036.693000001833</td><td>181.07843137254903</td></tr>
<tr></tr>
<tr><td>1763954944</td><td>5</td><td></td><td>Aggregated</td><td>1.000000</td><td>0.000000</td><td>2100</td><td>2200</td><td>4200</td><td>4200</td><td>4300</td><td>4700</td><td>5400</td><td>6000</td><td>6000</td><td>6000</td><td>6000</td><td>51</td><td>0</td><td>2100.0</td><td>2373.2055764709253</td><td>2.0343000069260597</td><td>6036.693000001833</td><td>181.07843137254903</td></tr>
<tr></tr>
<tr><td>1763954945</td><td>5</td><td></td><td>Aggregated</td><td>1.200000</td><td>0.000000</td><td>2100</td><td>2200</td><td>4200</td><td>4200</td><td>4300</td><td>4700</td><td>5400</td><td>6000</td><td>6000</td><td>6000</td><td>6000</td><td>53</td><td>0</td><td>2100.0</td><td>2362.6929660380447</td><td>2.0343000069260597</td><td>6036.693000001833</td><td>179.56603773584905</td></tr>
<tr></tr>
<tr><td>1763954946</td><td>5</td><td></td><td>Aggregated</td><td>1.000000</td><td>0.000000</td><td>2100</td><td>2200</td><td>4200</td><td>4200</td><td>4300</td><td>4700</td><td>5400</td><td>6000</td><td>6000</td><td>6000</td><td>6000</td><td>55</td><td>0</td><td>2100.0</td><td>2354.6817581825467</td><td>2.0343000069260597</td><td>6036.693000001833</td><td>177.85454545454544</td></tr>
<tr></tr></tbody>
            </table>
        </div>
    </div>
</li>
                    

                    <li><strong>Gráficas generadas por Locust</strong></li>
                    <div class="screenshot-item graph-shot">
                        <img src="files/Pruebas/smoke_20251123_212809/graficas.png" alt="Gráficas generadas por Locust" onclick="openImageModal(this.src)">
                    </div>
                </ol>
            </div>

            <!-- Reflexión -->
            <div class="reflection-section">
                <h3>Interpretación de resultados</h3>
                <ol>
                    <li><strong>¿Qué sistema es más sensible a picos de carga?</strong>
                       <p>En la prueba Smoke se observa que, incluso con solo 5 usuarios, el servicio más sensible es auth, específicamente el endpoint POST /auth/login. Sus tiempos de respuesta se mantienen entre 4,700 y 6,000 ms, mientras que el resto de los servicios responde entre 2,000 y 4,200 ms. La gráfica de percentil 95 confirma que la latencia más alta pertenece al proceso de login, lo que indica que ante un pico de carga este servicio sería el primero en degradarse.</p>
                    </li>
                    <li><strong>¿El CMS se comporta igual que los microservicios bajo carga de escritura?</strong>
                        <p>Basado en los resultados de Smoke, las operaciones POST son las de mayor latencia, mientras que las GET son más estables. Esto significa que, bajo carga, el CMS se comportaría de manera similar a los microservicios que realizan escritura, ya que típicamente involucra envío de formularios, registro o actualización de datos, actividades que reflejan el mismo patrón que las operaciones POST evaluadas aquí.</p>
                    </li>
                </ol>
            </div>

            <div class="reflection-section">
                <h3>Conclusiones y recomendaciones</h3>
                <p>Los resultados de la prueba Smoke indican que el sistema es funcional y estable bajo una carga mínima, ya que no se registraron fallas ni errores durante la ejecución. Sin embargo, los tiempos de respuesta revelan diferencias importantes entre los servicios: mientras que los endpoints GET operan con latencias relativamente bajas, el servicio de autenticación (especialmente el endpoint /auth/login) presenta tiempos elevados incluso con solo cinco usuarios.</p>

                <p>Estos resultados muestran que, aunque la disponibilidad básica está garantizada, el rendimiento aún no es óptimo para un entorno real. El comportamiento lento de las operaciones POST sugiere que existen cuellos de botella relacionados con la escritura de datos o validaciones internas.</p>

                <p>Finalmente, se recomienda implementar mecanismos de caching en operaciones repetitivas, mejorar el manejo de conexiones a la base de datos, y optimizar la lógica interna de validaciones.</p>
            </div>

            <div class="exercise-info">
                <h3>Anexos</h3>
                <div class="download-buttons">
                    <a class="btn" href="code/Pruebas/users.csv" download>Descargar CSV de usuarios</a>
                    <a class="btn" href="code/Pruebas/locustfile.py" download>Descargar locustfile.py</a>
                    <a class="btn" href="files/Pruebas/smoke_20251123_212809/">Abrir carpeta de resultados</a>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal para imágenes -->
    <div id="imageModal" class="image-modal" onclick="closeImageModal()">
        <span class="image-modal-close" onclick="closeImageModal()">&times;</span>
        <div class="image-modal-content" onclick="event.stopPropagation()">
            <img id="modalImage" src="" alt="">
        </div>
    </div>
</body>
</html>
